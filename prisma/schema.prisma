// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  // url       = env("DATABASE_URL")
  // directUrl = env("DIRECT_URL")
}

model Users {
  id                   BigInt       @id @default(autoincrement())
  tg_id                BigInt       @unique
  username             String?      @unique
  name                 String?
  is_premium           Boolean      @default(false)
  notification_enabled Boolean      @default(false)
  created_at           DateTime     @default(now())
  group_memberships    GroupUsers[]
  // groups               Groups[]

  @@index([username])
}

model Groups {
  id                 BigInt       @id @default(autoincrement())
  tg_id              BigInt       @unique
  // owner              Users?       @relation(fields: [owner_id], references: [id])
  // owner_id           BigInt?
  username           String?
  title              String?
  premium_user_count Int          @default(0)
  active             Boolean      @default(true)
  created_at         DateTime     @default(now())
  reward             Rewards?
  group_users        GroupUsers[]
}

model GroupUsers {
  id              BigInt           @id @default(autoincrement())
  group           Groups           @relation(fields: [group_id], references: [id])
  group_id        BigInt
  user            Users            @relation(fields: [user_id], references: [id])
  user_id         BigInt
  level           Int              @default(1)
  experience      BigInt           @default(0)
  message_count   BigInt           @default(0)
  is_admin        Boolean          @default(false)
  created_at      DateTime         @default(now())
  claimed_rewards ClaimedRewards[]

  @@unique([group_id, user_id])
  @@index([group_id])
  @@index([user_id])
}

model Rewards {
  id               BigInt           @id @default(autoincrement())
  group            Groups           @relation(fields: [group_id], references: [id])
  group_id         BigInt           @unique
  // amount           Int              @default(20)
  appearance_range Int              @default(20)
  appearance_after Int              @default(20)
  active           Boolean          @default(false)
  expires_at       BigInt           @default(0)
  created_at       DateTime         @default(now())
  claimed_rewards  ClaimedRewards[]
}

model ClaimedRewards {
  id            BigInt     @id @default(autoincrement())
  reward        Rewards    @relation(fields: [reward_id], references: [id])
  reward_id     BigInt
  group_user    GroupUsers @relation(fields: [group_user_id], references: [id])
  group_user_id BigInt
  claimed_at    DateTime   @default(now())

  @@unique([reward_id, group_user_id])
  @@index([group_user_id])
}

model Notifications {
  id           BigInt   @id @default(autoincrement())
  message      String
  image_url    String?
  sent         Boolean  @default(false)
  for_groups   Boolean  @default(false)
  scheduled_at BigInt
  created_at   DateTime @default(now())
}


// enum EventType {
//   ONCE
//   DAILY
//   WEEKLY
//   MONTHLY
// }


// model Events {
//   id          BigInt   @id @default(autoincrement())
//   type        EventType @default(WEEKLY)
//   name        String
//   details     String?
//   scheduled_at BigInt
//   last_triggered_at BigInt @default(0)
//   created_at  DateTime @default(now())
// }